<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>ä» heapq åˆ° TopK - é»„çŸ³çš„æ—¶ç©ºå›ç¯</title><link rel=icon type=image/png href=/img/favicon.png><meta name=viewport content="width=device-width,initial-scale=1">
<meta itemprop=name content="ä» heapq åˆ° TopK"><meta itemprop=description content="æœ€è¿‘åœ¨çœ‹ Python3 Cookbookï¼Œè¿˜æŒºæœ‰è¶£çš„ã€‚
Heapq å¯»æ‰¾æœ€å°/æœ€å¤§å…ƒç´  å…¶ä¸­ 1.4 èŠ‚æåˆ°äº†ä¸€ä¸ªé—®é¢˜ã€ŒæŸ¥æ‰¾æœ€å¤§æˆ–æœ€å°çš„ N ä¸ªå…ƒç´ ã€ï¼Œç”¨åˆ°äº†å†…ç½®çš„ heapq æ¨¡å—çš„ä¸¤ä¸ªå‡½æ•° nlargest() å’Œ nsmallest() ã€‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†æœ€å°/æœ€å¤§å †ï¼Œä»å †é¡¶å¾—åˆ°å †é‡Œé¢æœ€å°/æœ€å¤§çš„å…ƒç´ ã€‚"><meta itemprop=datePublished content="2021-03-16T00:00:00+00:00"><meta itemprop=dateModified content="2021-03-16T00:00:00+00:00"><meta itemprop=wordCount content="1409"><meta itemprop=keywords content="ç®—æ³•,Python"><meta property="og:url" content="https://yzlnew.com/2021/03/heapq-topk/"><meta property="og:site_name" content="é»„çŸ³çš„æ—¶ç©ºå›ç¯"><meta property="og:title" content="ä» heapq åˆ° TopK"><meta property="og:description" content="æœ€è¿‘åœ¨çœ‹ Python3 Cookbookï¼Œè¿˜æŒºæœ‰è¶£çš„ã€‚
Heapq å¯»æ‰¾æœ€å°/æœ€å¤§å…ƒç´  å…¶ä¸­ 1.4 èŠ‚æåˆ°äº†ä¸€ä¸ªé—®é¢˜ã€ŒæŸ¥æ‰¾æœ€å¤§æˆ–æœ€å°çš„ N ä¸ªå…ƒç´ ã€ï¼Œç”¨åˆ°äº†å†…ç½®çš„ heapq æ¨¡å—çš„ä¸¤ä¸ªå‡½æ•° nlargest() å’Œ nsmallest() ã€‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†æœ€å°/æœ€å¤§å †ï¼Œä»å †é¡¶å¾—åˆ°å †é‡Œé¢æœ€å°/æœ€å¤§çš„å…ƒç´ ã€‚"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-03-16T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-16T00:00:00+00:00"><meta property="article:tag" content="ç®—æ³•"><meta property="article:tag" content="Python"><meta name=twitter:card content="summary"><meta name=twitter:title content="ä» heapq åˆ° TopK"><meta name=twitter:description content="æœ€è¿‘åœ¨çœ‹ Python3 Cookbookï¼Œè¿˜æŒºæœ‰è¶£çš„ã€‚
Heapq å¯»æ‰¾æœ€å°/æœ€å¤§å…ƒç´  å…¶ä¸­ 1.4 èŠ‚æåˆ°äº†ä¸€ä¸ªé—®é¢˜ã€ŒæŸ¥æ‰¾æœ€å¤§æˆ–æœ€å°çš„ N ä¸ªå…ƒç´ ã€ï¼Œç”¨åˆ°äº†å†…ç½®çš„ heapq æ¨¡å—çš„ä¸¤ä¸ªå‡½æ•° nlargest() å’Œ nsmallest() ã€‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†æœ€å°/æœ€å¤§å †ï¼Œä»å †é¡¶å¾—åˆ°å †é‡Œé¢æœ€å°/æœ€å¤§çš„å…ƒç´ ã€‚"><link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel=stylesheet type=text/css><link rel=stylesheet type=text/css media=screen href=https://yzlnew.com/css/main.css><link rel=stylesheet type=text/css href=https://yzlnew.com/css/custom.css><link id=dark-scheme rel=stylesheet type=text/css href=https://yzlnew.com/css/dark.css><link id=dark-scheme rel=stylesheet type=text/css href=https://yzlnew.com/css/custom_dark.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://yzlnew.com/js/main.js></script></head><body><div class="container wrapper"><div class=header><div class=avatar><a href=https://yzlnew.com/><img src=/img/avatar.png alt=é»„çŸ³çš„æ—¶ç©ºå›ç¯></a></div><h1 class=site-title><a href=https://yzlnew.com/>é»„çŸ³çš„æ—¶ç©ºå›ç¯</a></h1><div class=site-description><p>Let me fly to the ğŸŒ•ï¸</p></div><nav class=nav><ul class=flat><li><a href=/>ä¸»é¡µ</a></li><li><a href=/about>å…³äºæˆ‘</a></li><li><a href=/tags>æ ‡ç­¾</a></li></ul></nav></div><div class=sidebar><h4>æ–‡ç« ç›®å½•</h4><nav id=TableOfContents><ul><li><a href=#heapq-å¯»æ‰¾æœ€å°æœ€å¤§å…ƒç´ ><code>Heapq</code> å¯»æ‰¾æœ€å°/æœ€å¤§å…ƒç´ </a><ul><li><a href=#å»ºå †>å»ºå †</a></li><li><a href=#å¤æ‚åº¦>å¤æ‚åº¦</a></li></ul></li><li><a href=#å¿«é€Ÿé€‰æ‹©ç®—æ³•>å¿«é€Ÿé€‰æ‹©ç®—æ³•</a></li></ul></nav></div><div class=post><article><div class=post-header><div class=matter><h1 class=title>ä» heapq åˆ° TopK</h1><div class=meta><span class=date>2021-03-16</span>
<span class="busuanzi page" id=busuanzi_container_page_pv><div class=tags><ul class=flat><li><a href=/tags/%E7%AE%97%E6%B3%95>ç®—æ³•</a></li><li><a href=/tags/python>python</a></li></ul></div></div></div></div></article><div class=markdown><p>æœ€è¿‘åœ¨çœ‹ Python3 Cookbookï¼Œè¿˜æŒºæœ‰è¶£çš„ã€‚</p><h3 id=heapq-å¯»æ‰¾æœ€å°æœ€å¤§å…ƒç´ ><code>Heapq</code> å¯»æ‰¾æœ€å°/æœ€å¤§å…ƒç´ </h3><p>å…¶ä¸­ 1.4 èŠ‚æåˆ°äº†ä¸€ä¸ªé—®é¢˜ã€ŒæŸ¥æ‰¾æœ€å¤§æˆ–æœ€å°çš„ N ä¸ªå…ƒç´ ã€ï¼Œç”¨åˆ°äº†å†…ç½®çš„ <code>heapq</code> æ¨¡å—çš„ä¸¤ä¸ªå‡½æ•° <code>nlargest()</code> å’Œ <code>nsmallest()</code> ã€‚æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†æœ€å°/æœ€å¤§å †ï¼Œä»å †é¡¶å¾—åˆ°å †é‡Œé¢æœ€å°/æœ€å¤§çš„å…ƒç´ ã€‚</p><p>æŸ¥çœ‹ <code>CPython</code> æºç ï¼Œ<code>nsmallest()</code> ä¸€æ®µå…¸å‹çš„å®ç°æ˜¯è¿™æ ·çš„ï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-weight:700>if</span> key <span style=color:#080>is</span> <span style=color:#080;font-weight:700>None</span>:
</span></span><span style=display:flex><span>    it = <span style=color:#038>iter</span>(iterable)
</span></span><span style=display:flex><span>    <span style=color:#888># put the range(n) first so that zip() doesn&#39;t</span>
</span></span><span style=display:flex><span>    <span style=color:#888># consume one too many elements from the iterator</span>
</span></span><span style=display:flex><span>    result = [(elem, i) <span style=color:#080;font-weight:700>for</span> i, elem <span style=color:#080>in</span> <span style=color:#038>zip</span>(<span style=color:#038>range</span>(n), it)]
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>if</span> <span style=color:#080>not</span> result:
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>return</span> result
</span></span><span style=display:flex><span>    _heapify_max(result)
</span></span><span style=display:flex><span>    top = result[<span style=color:#00d;font-weight:700>0</span>][<span style=color:#00d;font-weight:700>0</span>]
</span></span><span style=display:flex><span>    order = n
</span></span><span style=display:flex><span>    _heapreplace = _heapreplace_max
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>for</span> elem <span style=color:#080>in</span> it:
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>if</span> elem &lt; top:
</span></span><span style=display:flex><span>            _heapreplace(result, (elem, order))
</span></span><span style=display:flex><span>            top, _order = result[<span style=color:#00d;font-weight:700>0</span>]
</span></span><span style=display:flex><span>            order += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>    result.sort()
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> [elem <span style=color:#080;font-weight:700>for</span> (elem, order) <span style=color:#080>in</span> result]
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œè€ƒè™‘æ²¡æœ‰ <code>key</code> å‚æ•°çš„æ—¶å€™çš„æ™®éæƒ…å†µã€‚</p><ol><li><code>_heapify_max</code> é€šè¿‡ä¸€ä¸ª <code>in-place</code> çš„æ–¹æ³•æŠŠåŒ…å«å‰ k ä¸ªå…ƒç´ å’Œåºå·çš„å…ƒç»„åˆ—è¡¨ <code>result</code> æœ€å¤§å †åŒ–ã€‚</li><li><code>_heapreplace</code> æ˜¯æœ€å¤§å †ä¸Š <code>heappop + heappush</code> ã€‚å¯¹æ‰€æœ‰çš„å…ƒç´ å¾ªç¯ï¼Œå¦‚æœå…ƒç´ æ¯”å †é¡¶å°ï¼Œé‚£ä¹ˆå †é¡¶ä¸é…åœ¨ç»“æœé‡Œé¢ï¼ŒæŠŠå †é¡¶å¼¹å‡ºï¼Œç„¶åæ–°å…ƒç´ çš„å…ƒç»„åŠ è¿›å»ã€‚</li><li>æœ€åå¯¹ k ä¸ªå…ƒç´ æ’åºï¼Œå°±å¯ä»¥è¾“å‡ºã€‚</li></ol><p>å¦å¤–åœ¨ä»£ç çš„æ³¨é‡Šé‡Œé¢ï¼Œè¿˜ç»™å‡ºäº†å„ä¸ªæ­¥éª¤è¿›è¡Œæ¯”è¾ƒçš„æ¬¡æ•°ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#888># Step   Comparisons                  Action</span>
</span></span><span style=display:flex><span><span style=color:#888># ----   --------------------------   ---------------------------</span>
</span></span><span style=display:flex><span><span style=color:#888>#  1     1.66 * k                     heapify the first k-inputs</span>
</span></span><span style=display:flex><span><span style=color:#888>#  2     n - k                        compare remaining elements to top of heap</span>
</span></span><span style=display:flex><span><span style=color:#888>#  3     k * (1 + lg2(k)) * ln(n/k)   replace the topmost value on the heap</span>
</span></span><span style=display:flex><span><span style=color:#888>#  4     k * lg2(k) - (k/2)           final sort of the k most extreme values</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=å»ºå †>å»ºå †</h4><p>é¦–å…ˆç¬¬ä¸€æ­¥å»ºå †ï¼Œä¸€ä¸ª <code>bottom up</code> çš„å»ºå †è¿‡ç¨‹å¯ä»¥æè¿°ä¸ºï¼š</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#888># heapify(x)</span>
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>heapify</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>for</span> i = <span style=color:#038>reversed</span>(<span style=color:#038>range</span>(<span style=color:#038>len</span>(x)//<span style=color:#00d;font-weight:700>2</span>)):
</span></span><span style=display:flex><span>        _siftup(x,i)
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ <code>_siftup</code> å³ä¸ºã€Šç®—æ³•å¯¼è®ºã€‹ä¸­æåˆ°çš„ <code>MIN-HEAPIFY</code> æ“ä½œï¼Œç›®çš„æ˜¯ä¿æŒå †çš„æ€§è´¨ï¼Œä½¿å¾—ä»¥ <code>i</code> ä¸ºæ ¹çš„å †æ»¡è¶³æœ€å°å †çš„æ€§è´¨ã€‚å› ä¸ºå¤§äºå¾ªç¯èŒƒå›´çš„ç»“ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå·²ç»æ»¡è¶³å †æ€§è´¨ã€‚</p><p>è¿™é‡Œå¦‚æœä»”ç»†è¯»äº† <code>_siftup</code> æºç åŠæ³¨é‡Šå¯ä»¥å‘ç°ï¼Œå®é™…å®ç°å’Œä¹¦ä¸Šçš„æ–¹æ³•ä¸å¤ªä¸€æ ·ï¼š</p><ol><li><code>MIN-HEAPIFY</code> åœ¨å¤§å¤šä¹¦ä¸Šä¼šåœ¨å½“å‰èŠ‚ç‚¹æ»¡è¶³å°äºä¸¤ä¸ªå­èŠ‚ç‚¹å°±ç»§ç»­å¾ªç¯</li><li><code>_siftup</code> ä¼šæŠŠå½“å‰å­æ ‘çš„å€¼æœ€å°çš„èŠ‚ç‚¹ä¸Šæµ®</li></ol><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œä¸»è¦åŸå› æ˜¯ <code>heappop</code> ä¹Ÿç”¨åˆ°äº†è¿™ä¸ªå†…éƒ¨å‡½æ•°ï¼Œè€Œå½“ <code>pop</code> å†è°ƒæ•´çš„æ—¶å€™ï¼Œæœ€æœ«çš„èŠ‚ç‚¹ä¼šç§»åŠ¨åˆ°å †é¡¶ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬éƒ½è¦æ¯”ä¸¤ä¸ªå­èŠ‚ç‚¹å¤§ï¼Œå› æ­¤å¹¶ä¸èƒ½æå‰ç»ˆæ­¢å¾ªç¯ã€‚è€Œå¯¹äºè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå› ä¸ºèŠ‚ç‚¹çš„å€¼å¯èƒ½æ˜¯å…ƒç»„ï¼Œæ¯”è¾ƒæ“ä½œçš„ä»£ä»·æ¯”è¾ƒæ˜‚è´µï¼Œç”¨åé¢çš„æ–¹æ³•å¯ä»¥æœ‰æ•ˆå‡å°‘ <code>heappop</code> æ¯”è¾ƒçš„æ¬¡æ•°ã€‚</p><h4 id=å¤æ‚åº¦>å¤æ‚åº¦</h4><p>å †è°ƒæ•´çš„å¤æ‚åº¦å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•åˆ†æå¾—åˆ°ï¼š</p><p>$$T(k) \le T(2k/3) + \Theta(1)$$</p><p>å…¶ä¸­ $2n/3$ æ˜¯æœ€åæƒ…å†µï¼ŒåŠåº•å±‚æ°å¥½åŠæ»¡çš„æ—¶å€™ï¼Œé€’å½’è°ƒç”¨è¯¥å­æ ‘æ—¶æœ€å¤§çš„èŠ‚ç‚¹æ•°é‡ã€‚æœ€åå¯ä»¥å¾—åˆ°è°ƒæ•´çš„å¤æ‚åº¦ä¸º $O(\lg n) = O(h)$ã€‚</p><p>å¦å¤–ï¼Œå»ºå †çš„å¤æ‚åº¦ï¼ŒæŒ‰ç…§ <code>MIN-HEAPIFY</code> çš„æ–¹æ³•ï¼Œåœ¨é«˜åº¦ <code>h</code> ä¸Šï¼ˆé«˜åº¦å®šä¹‰ä¸ºä»æœ¬èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€é•¿ç®€å•ä¸‹é™è·¯å¾„çš„è¾¹çš„æ•°é‡ï¼‰ï¼Œæœ€å¤šæœ‰ $\lceil \frac{k}{2^{h+1}} \rceil$ ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥è®¡ç®—æ€»å¤æ‚åº¦ä¸º</p><p>$$\sum_{h=0}^{\lfloor\lg k\rfloor}\left[\frac{k}{2^{h+1}}\right\rceil O(h)=O\left(k \sum_{h=0}^{\lfloor\lg k\rfloor} \frac{h}{2^{h}}\right) = O(k)$$</p><p>åŒæ—¶çœ‹åˆ°æºç æ³¨é‡Šé‡Œé¢ç»™å‡ºçš„æ˜¯ <code>1.66*k</code> çš„æ¯”è¾ƒæ¬¡æ•°ã€‚</p><p>æ•´ä½“çš„å¤æ‚åº¦å°±æ˜¯ $O(n\lg k)$ã€‚</p><h3 id=å¿«é€Ÿé€‰æ‹©ç®—æ³•>å¿«é€Ÿé€‰æ‹©ç®—æ³•</h3><p>æœ‰æ²¡æœ‰æ›´å¿«çš„ç®—æ³•å‘¢ï¼Ÿæœ‰çš„ã€‚ç±»ä¼¼äºå¿«é€Ÿæ’åºçš„å¿«é€Ÿé€‰æ‹©ç®—æ³•ã€‚</p><p>ä¸»è¦é‡‡ç”¨äº†å¿«æ’çš„åˆ‡åˆ†çš„æ“ä½œï¼Œä½†æ˜¯åªè¿­ä»£ç¬¦åˆè¦æ±‚çš„ä¸€ä¾§å…ƒç´ ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€ç­”çš„ Python å®ç°ã€‚</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>Solution</span>:
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>getLeastNumbers</span>(self, data: <span style=color:#038>list</span>, k: <span style=color:#038>int</span>) -&gt; <span style=color:#038>list</span>:
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>if</span> (k==<span style=color:#00d;font-weight:700>0</span> <span style=color:#080>or</span> <span style=color:#038>len</span>(data)==<span style=color:#00d;font-weight:700>0</span>): <span style=color:#080;font-weight:700>return</span> []
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>return</span> self.quick_select(data, <span style=color:#00d;font-weight:700>0</span>, <span style=color:#038>len</span>(data)-<span style=color:#00d;font-weight:700>1</span>, k-<span style=color:#00d;font-weight:700>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>quick_select</span>(self, nums: <span style=color:#038>list</span>, lo: <span style=color:#038>int</span>, hi: <span style=color:#038>int</span>, pos: <span style=color:#038>int</span>) -&gt; <span style=color:#038>list</span>:
</span></span><span style=display:flex><span>        j = self.partition(nums, lo, hi)
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>if</span> (j==pos): <span style=color:#080;font-weight:700>return</span> <span style=color:#038>list</span>(nums[:j+<span style=color:#00d;font-weight:700>1</span>])
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>if</span> (j&lt;pos): <span style=color:#080;font-weight:700>return</span> self.quick_select(nums, j+<span style=color:#00d;font-weight:700>1</span>, hi, pos)
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>if</span> (j&gt;pos): <span style=color:#080;font-weight:700>return</span> self.quick_select(nums, lo, j-<span style=color:#00d;font-weight:700>1</span>, pos)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>partition</span>(self, nums, lo: <span style=color:#038>int</span>, hi: <span style=color:#038>int</span>) -&gt; <span style=color:#038>int</span>:
</span></span><span style=display:flex><span>        pivot = nums[lo]
</span></span><span style=display:flex><span>        i, j = lo, hi+<span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>while</span>(<span style=color:#080;font-weight:700>True</span>):
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>while</span>(<span style=color:#080;font-weight:700>True</span>):
</span></span><span style=display:flex><span>                i += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>                <span style=color:#080;font-weight:700>if</span> (i &gt; hi <span style=color:#080>or</span> nums[i] &gt;= pivot):
</span></span><span style=display:flex><span>                    <span style=color:#080;font-weight:700>break</span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>while</span>(<span style=color:#080;font-weight:700>True</span>):
</span></span><span style=display:flex><span>                j -= <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>                <span style=color:#080;font-weight:700>if</span> (j &lt; lo <span style=color:#080>or</span> nums[j] &lt;= pivot):
</span></span><span style=display:flex><span>                    <span style=color:#080;font-weight:700>break</span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>if</span>(i &gt;= j): <span style=color:#080;font-weight:700>break</span>
</span></span><span style=display:flex><span>            nums[i], nums[j] = nums[j], nums[i]
</span></span><span style=display:flex><span>        nums[lo], nums[j] = nums[j], nums[lo]
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>return</span> j
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>partition1</span>(self, nums, lo: <span style=color:#038>int</span>, hi: <span style=color:#038>int</span>) -&gt; <span style=color:#038>int</span>:
</span></span><span style=display:flex><span>        pivot = nums[lo]
</span></span><span style=display:flex><span>        i, j = lo+<span style=color:#00d;font-weight:700>1</span>, hi
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>while</span>(<span style=color:#080;font-weight:700>True</span>):
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>while</span>(i &lt;= j <span style=color:#080>and</span> nums[i] &lt;= pivot):
</span></span><span style=display:flex><span>                i += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>while</span>(i &lt;= j <span style=color:#080>and</span> nums[j] &gt;= pivot):
</span></span><span style=display:flex><span>                j -= <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>if</span>(i &gt;= j): <span style=color:#080;font-weight:700>break</span>
</span></span><span style=display:flex><span>            nums[i], nums[j] = nums[j], nums[i]
</span></span><span style=display:flex><span>        nums[lo], nums[j] = nums[j], nums[lo]
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>return</span> j
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>partition2</span>(self, nums, lo: <span style=color:#038>int</span>, hi: <span style=color:#038>int</span>) -&gt; <span style=color:#038>int</span>:
</span></span><span style=display:flex><span>        pivot = nums[hi]
</span></span><span style=display:flex><span>        store_idx = lo
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>for</span> i <span style=color:#080>in</span> <span style=color:#038>range</span>(lo,hi):
</span></span><span style=display:flex><span>            <span style=color:#080;font-weight:700>if</span> nums[i] &lt;= pivot:
</span></span><span style=display:flex><span>                nums[store_idx], nums[i] = nums[i], nums[store_idx]
</span></span><span style=display:flex><span>                store_idx += <span style=color:#00d;font-weight:700>1</span>
</span></span><span style=display:flex><span>        nums[hi], nums[store_idx] = nums[store_idx], nums[hi]
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>return</span> store_idx
</span></span></code></pre></td></tr></table></div></div><p>å› ä¸ºæ¯æ¬¡å¹³å‡åªéœ€è¦éå†ä¹‹å‰æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œå› æ­¤å¹³å‡å¤æ‚åº¦ä¸º $O(n)$ï¼Œå½“ç„¶æœ€åçš„å¤æ‚åº¦è¿˜æ˜¯ $O(n^2)$ï¼Œå…³é”®è¿˜æ˜¯çœ‹åŸºå‡†å€¼çš„é€‰æ‹©ã€‚å› æ­¤é’ˆå¯¹æ­¤ç®—æ³•çš„ä¼˜åŒ–å˜ä½“åŸºæœ¬ä¸Šå›´ç»•åŸºå‡†å€¼çš„é€‰æ‹©ï¼Œæ¯”å¦‚éšæœºã€ <a href=https://en.wikipedia.org/wiki/Median_of_medians>BFPRT</a> ã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€äº›å¹¶è¡Œçš„æ–¹æ³•ï¼Œæ¯”å¦‚<a href=https://www.doc.ic.ac.uk/~hlgr/pdfs/MassivelyParallelTopK.pdf>è¿™ç¯‡è®ºæ–‡</a> ã€‚</p></div><div class=page-visit># æœ¬æ–‡ä¸€å…±è¢«è®¿é—®äº† <span id=busuanzi_value_page_pv></span>&nbsp;æ¬¡ã€‚</span></div><div id=utter-container></div><script src=https://utteranc.es/client.js repo=yzlnew/yzlnew.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div><div class="footer wrapper"><div class=social-links><ul class=social-media-list><li><a href=mailto:yzlnew@gmail.com title=Mail><i data-feather=mail></i></a></li><li><a href=https://github.com/yzlnew title=Github><i data-feather=github></i></a></li><li><a href=https://t.me/r0brew title=Telegram><i data-feather=message-square></i></a></li><li><a href=/index.xml title=RSS><i data-feather=rss></i></a></li></ul></div><nav class=copyright><div>2021 Â© Copyright Ye Zhiling</div></nav><div class=site-visit><span id=busuanzi_container_site_pv><i data-feather=compass></i><span id=busuanzi_value_site_pv></span>
</span><span id=busuanzi_container_site_uv><i data-feather=users></i><span id=busuanzi_value_site_uv></span></span></div></div><script>feather.replace()</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></body></html>