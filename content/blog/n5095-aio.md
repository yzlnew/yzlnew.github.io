---
date: 2022-06-10
lastmod: 2022-06-10
title: N5095 All in One 折腾记
tags:
  - 软路由
  - 家庭网络
draft: false
toc: true
description: 人生苦短，折腾起来
---

最近 618，机缘巧合在 smzdm 评论区看到最近有台小主机很火热，就是带 4 个 2.5G 网口的 N5095。家里目前有的设备包括：

- QNAP TS-451D：四盘位 J4025 的 NAS，二核性能一般，上面跑了不少 Docker 服务。
- 小米 AX3600：作为主路由，刷了 Openwrt 并且改了 1G 的内存，其实完全满足我的需求了。

六月初的时候看到 N5095 准系统只要 665，就顺势拿下了（其实应该更应该买 N5105 的，贵几十，但是核显性能更好一点）。顺便买了内存和硬盘，都是在京东挑便宜的买，然后因为据说这个模具散热不好，又再 PDD 花 10 块钱买了个小风扇。总的成本在 1000 以下。

![N5095](https://raw.githubusercontent.com/yzlnew/ImageBed/master/blog/2022n5095-hardware%20(Phone).jpg)

没想到短短几天就有猫毛在风扇上了，囧rz。

## 准备工作

自从上次玩 AX3600 固件 BOOM 了之后，越发觉得在硬路由上搞一些骚操作有点太为难自己了。买 N5095 主要也是需要一个软路由，另外把 NAS 上一些服务迁移到上面，减少点负担。

在硬件到货之前，先看了几个 up 主的视频，完全从零开始看司波图[1]的就挺好。基本能搞明白这台软路由在家庭网络里面的位置。刚好他的拓扑比较符合我的需求，我没有也不需要一个交换机。大致的网络拓扑如下所示：

![Network Overview](https://raw.githubusercontent.com/yzlnew/ImageBed/master/blog/2022n5095-aio.png)


## 几个小问题

### 主系统选什么

宿主系统可以选 [Proxmox VE](https://www.proxmox.com/en/)、[VMware ESXi](https://www.vmware.com/products/esxi-and-esx.html)、[Windows Server 2022](https://www.microsoft.com/en-us/windows-server)等等，看个人喜好了，甚至装个 Arch、Ubuntu 之类的都可以。之前没有太多的了解，看上去 PVE 的管理比较简单，另外参考[^2]，如果要核显直通的话可以选 Win Server。

### Jellyfin 核显硬解

这算是这几个 11 代 U 比较坑的点，它们是[不支持 GVT-g](https://www.intel.com/content/www/us/en/support/articles/000058558/graphics.html) 的，核显不能直通给虚拟机。在 PVE 下要核显硬解的话，也就两个方案：

1. LXC 下装 Debian，里面用 Beta 版的 Jellyfin，推荐 `nyanmisaka/jellyfin` 这个镜像[^3]，里面打了核显驱动和一些中文本地化优化。另外只要强制开启转码就可以了[^4]。
2. 核显指派给 LXC，在 Debian 里裸装 Jellyfin[^5]。

我比较倾向于方案一，看视频效率比较低，可以直接看 Jellyfin 的官方硬解文档[^6]。

### 有哪些自建服务

查看 [Awesome-Selfhosted](https://github.com/awesome-selfhosted/awesome-selfhosted)。目前我把 PT 下载、aria2 和 Nextcloud 留在 NAS 上，Home Assistant、Jellyfin 迁移到了 N5095 上，另外上面还有 frp 的反代。

## 参考资料

- [^1]: [2022版通用型PVE_AIO服务器布局教程](https://www.bilibili.com/video/BV1GY41177Es)
- [^2]: [系统安装及核显硬解](https://www.bilibili.com/video/BV18L4y1F7gN)
- [^3]: [Jellyfin 中国特供版](https://www.bilibili.com/read/cv14514123)
- [^4]: [PVE 下 Jellyfin 核显硬解](https://www.bilibili.com/video/BV1sB4y197RS)
- [^5]: [PVE 下核显硬解](https://www.bilibili.com/video/BV1dY4y137PB)
- [^6]: [Hardware Acceleration](https://jellyfin.org/docs/general/administration/hardware-acceleration.html#intel-gen9-and-gen11-igpus)